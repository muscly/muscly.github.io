<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<!-- iOS Safari -->
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
<!-- Chrome, Firefox OS and Opera Status Bar Color -->
<meta name="theme-color" content="#FFFFFF">
<link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.11.1/katex.min.css">
<link rel="stylesheet" type="text/css"
  href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.19.0/themes/prism.min.css">
<link rel="stylesheet" type="text/css" href="css/SourceSansPro.css">
<link rel="stylesheet" type="text/css" href="css/theme.css">
<link rel="stylesheet" type="text/css" href="css/notablog.css">
<!-- Favicon -->

  <link rel="shortcut icon" href="data:image/svg+xml,&lt;svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22&gt;&lt;text text-anchor=%22middle%22 dominant-baseline=%22middle%22 x=%2250%22 y=%2255%22 font-size=%2280%22&gt;🤫&lt;/text&gt;&lt;/svg&gt;">

<style>
  :root {
    font-size: 20px;
  }
</style>

<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-3B8EKKV9YC"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-3B8EKKV9YC');
</script>

  <title>2 패스 셰이더 포팅,b,&nbsp;|&nbsp;Secret Wiki</title>
  <meta property="og:type" content="blog">
  <meta property="og:title" content="2 패스 셰이더 포팅,b,">
  
  
  <style>
    .DateTagBar {
      margin-top: 1.0rem;
    }
  </style>
</head>

<body>
  <nav class="Navbar">
  <a href="index.html">
    <div class="Navbar__Btn">
      
        <span><img class="inline-img-icon" src="data:image/svg+xml,&lt;svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22&gt;&lt;text text-anchor=%22middle%22 dominant-baseline=%22middle%22 x=%2250%22 y=%2255%22 font-size=%2280%22&gt;🤫&lt;/text&gt;&lt;/svg&gt;"></span>&nbsp;
      
      <span>Home</span>
    </div>
  </a>
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
      <span class="Navbar__Delim">&centerdot;</span>
      <a href="happiness .html">
        <div class="Navbar__Btn">
          
            <span><img class="inline-img-icon" src="data:image/svg+xml,&lt;svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22&gt;&lt;text text-anchor=%22middle%22 dominant-baseline=%22middle%22 x=%2250%22 y=%2255%22 font-size=%2280%22&gt;😀&lt;/text&gt;&lt;/svg&gt;"></span>&nbsp;
          
          <span>행복</span>
        </div>
      </a>
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
      <span class="Navbar__Delim">&centerdot;</span>
      <a href="about.html">
        <div class="Navbar__Btn">
          
            <span><img class="inline-img-icon" src="data:image/svg+xml,&lt;svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22&gt;&lt;text text-anchor=%22middle%22 dominant-baseline=%22middle%22 x=%2250%22 y=%2255%22 font-size=%2280%22&gt;👨‍💻&lt;/text&gt;&lt;/svg&gt;"></span>&nbsp;
          
          <span>About</span>
        </div>
      </a>
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
</nav>
  <header class="Header">
    
    <div class="Header__Spacer Header__Spacer--NoCover">
    </div>
    
    <h1 class="Header__Title">2 패스 셰이더 포팅,b,</h1>
    
      <div class="DateTagBar">
        
          <span class="DateTagBar__Item DateTagBar__Date">Posted on Thu, Feb 20, 2020</span>
        
        
          <span class="DateTagBar__Item DateTagBar__Tag DateTagBar__Tag--default">
            <a href="tag/유니티3D.html">유니티3D</a>
          </span>
        
          <span class="DateTagBar__Item DateTagBar__Tag DateTagBar__Tag--yellow">
            <a href="tag/URP.html">URP</a>
          </span>
        
          <span class="DateTagBar__Item DateTagBar__Tag DateTagBar__Tag--blue">
            <a href="tag/URP 포팅.html">URP 포팅</a>
          </span>
        
      </div>
    
  </header>
  <article id="https://www.notion.so/f6ea54f1ee2f47cca4d729d5be228102" class="PageRoot"><div id="https://www.notion.so/2c6ad484362c467cba6bde39ab0e7ab5" class="Image Image--Normal"><figure><a href="https://www.notion.so/signed/https%3A%2F%2Fs3-us-west-2.amazonaws.com%2Fsecure.notion-static.com%2F14725eb4-74cb-491d-b832-bdcc5186e85a%2FUntitled.png?width=696&amp;table=block&amp;id=2c6ad484-362c-467c-ba6b-de39ab0e7ab5"><img src="https://www.notion.so/signed/https%3A%2F%2Fs3-us-west-2.amazonaws.com%2Fsecure.notion-static.com%2F14725eb4-74cb-491d-b832-bdcc5186e85a%2FUntitled.png?width=696&amp;table=block&amp;id=2c6ad484-362c-467c-ba6b-de39ab0e7ab5" style="width:696px"/></a><figcaption><span class="SemanticStringArray"></span></figcaption></figure></div><div id="https://www.notion.so/79bdf8a285034cf0863d0bb7ad4820b8" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">URP 포팅 시리즈의 4번째 포스트 입니다. 지난 번에는 커스텀 라이팅 헤어 셰이더를 URP용 HLSL로 포팅하는 과정을 기록했습니다. 이번에는 헤어 셰이더가 2 패스로 구현된 부분을 포팅하는 기록입니다. 작업 기록을 옮긴 것이라 중간에 실수하고 착각하는 내용도 있습니다. 오해의 여지가 있는 부분은 괄호 안에 첨언했습니다.</span></span></p></div><div id="https://www.notion.so/78a9c68e671e4cbc9f16960d89252d64" class="Divider"></div><div id="https://www.notion.so/4f9b67cd4b384d90b8e45c6d8080433c" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">이 셰이더는 알파테스트와 알파 블렌딩 두 개의 패스로 구현된 셰이더인데, URP에서는 멀티 패스 셰이더를 지원하지 않는다. 방법 중의 하나는 Renderer Features 기능을 사용해서 URP 렌더러에 끼워 넣는 방식. RenderObjects를 사용하면 C# 코딩을 안하고도 가능한 방법이 있다.</span></span></p></div><div id="https://www.notion.so/e45f0d10ec80453d855cc59d18c41638" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString"><span class="SemanticString__Fragment SemanticString__Fragment--Resource"><a href="toon-shading-universalrp.html"><span class="SemanticStringArray"><span class="SemanticString"><strong class="SemanticString__Fragment SemanticString__Fragment--Bold">Universal RP로 구현한 툰 셰이딩</strong></span></span></a></span></span><span class="SemanticString"> </span></span></p></div><div id="https://www.notion.so/7389f037e23b4f10af75fd748364152a" class="ColorfulBlock ColorfulBlock--BgGray Callout"><div class="Callout__Icon"><div class="Icon">💡</div></div><p class="Callout__Content"><span class="SemanticStringArray"><span class="SemanticString"><strong class="SemanticString__Fragment SemanticString__Fragment--Bold"><strong class="SemanticString__Fragment SemanticString__Fragment--Bold">Renderer Features와 RenderObjects란?
</strong></strong></span><span class="SemanticString">Renderer Features란 URP 렌더러를 확장할 수 있는 기능입니다. ScriptableRendererFeature 클래스를 상속받아서 나만의 Renderer Feature를 만들어 렌더링 패스를 끼워 넣을 수 있습니다. RenderObjects란 URP에서 미리 만들어 놓은 Renderer Feature 중에 하나로 원하는 오브젝트를 다른 재질을 사용해서 다시 그릴 수 있는 기능입니다.</span></span></p></div><div id="https://www.notion.so/bb99ad05d87f41a78aa377d35423f9da" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">RendererObjects를 사용하면 추가 패스를 어느 시점에 끼워 넣을지 고를 수 있다.</span></span></p></div><div id="https://www.notion.so/a5717302ed8845eeb71967fe6ba3a652" class="Image Image--Normal"><figure><a href="https://www.notion.so/signed/https%3A%2F%2Fs3-us-west-2.amazonaws.com%2Fsecure.notion-static.com%2F80c828f8-88ee-4468-8498-569190aab505%2FUntitled.png?width=265&amp;table=block&amp;id=a5717302-ed88-45ee-b719-67fe6ba3a652"><img src="https://www.notion.so/signed/https%3A%2F%2Fs3-us-west-2.amazonaws.com%2Fsecure.notion-static.com%2F80c828f8-88ee-4468-8498-569190aab505%2FUntitled.png?width=265&amp;table=block&amp;id=a5717302-ed88-45ee-b719-67fe6ba3a652" style="width:265px"/></a><figcaption><span class="SemanticStringArray"></span></figcaption></figure></div><div id="https://www.notion.so/5155f80e4e7041a59ed32a4345dbfa29" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">어떤 오브젝트를 다시 그릴지는 렌더 큐, 레이어, 셰이더 패스 이름으로 필터링 할 수 있다. 예를 들어, 모든 몹에 대해서 아웃라인을 그린다든지 할 때는 몹 레이어로 필터링을 하면 되는 식. 근데, 내 경우에는 멀티 패스 렌더링을 위해서 레이어를 하나 소비하고 싶지는 않다. 그렇다면, 큐와 패스 필터만으로 어떻게 할 수 있을까? 자세한 문서를 못 찾겠다. 코드를 뒤져보자.</span></span></p></div><div id="https://www.notion.so/d4a2e889144d463c9743d56ecf58f057" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">RenderObject.cs 안에 ScriptableRendererFeature를 상속받은 RenderObject 클래스가 있다. 모든 필터링 설정은 ScriptableRenderPass를 상속받은 RenderObjectsPass 클래스로 넘어간다. 그 안에서 렌더 큐와 레이어 마스크는 UnityEngine.Rendering.FilteringSettings에 보관되고,  패스는 UnityEngine.Rendering.DrawingSettings로 넘어간다. 그 두 가지 모두 ScriptableRenderContext.DrawRenderers() 로 넘겨진다. 소스 코드가 공개 안된 부분이라서 더 이상 추적 불가. 매뉴얼을 보자.</span></span></p></div><div id="https://www.notion.so/e1519d43e4f0415f9d57b9f6a6753795" class="Bookmark"><a href="https://docs.unity3d.com/ScriptReference/Rendering.DrawingSettings.SetShaderPassName.html"><h5 class="Bookmark__Title">Unity - Scripting API: Rendering.DrawingSettings.</h5><p class="Bookmark__Desc">Thank you for helping us improve the quality of Unity Documentation. Although we cannot accept all submissions, we do read each suggested change from our users and will make updates where applicable. For some reason your suggested change could not be submitted. Please try again in a few minutes.</p><p class="Bookmark__Link">https://docs.unity3d.com/ScriptReference/Rendering.DrawingSettings.SetShaderPassName.html</p></a></div><div id="https://www.notion.so/05418421658c4fb18bddd08cc3e5af7d" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">지정한 패스만 그리게 되니 필터의 역할이 맞다. 해당 패스만 그리되 설정해둔 Override Material을 사용해서 그리는 것 같다.  ForwardLit 이라고 되어 있던 Pass 이름을 ForwardLitHair로 바꿔보자. 렌더링은 잘된다.  (잘 되는 것처럼 보이지만 사실은 아니었습니다. 이유는 뒤에서…)</span></span></p></div><div id="https://www.notion.so/8113bd5fabfd4a0d8afa48d5bd3a4b1f" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">Render Objects를 끼워 넣어보자. 아래처럼 URP 렌더러에 추가.</span></span></p></div><div id="https://www.notion.so/1236db2e39df4dafbdac883e1df13e89" class="Image Image--Normal"><figure><a href="https://www.notion.so/signed/https%3A%2F%2Fs3-us-west-2.amazonaws.com%2Fsecure.notion-static.com%2F55b56e06-0063-4b08-a2e2-4b37f0842fd0%2FUntitled.png?width=696&amp;table=block&amp;id=1236db2e-39df-4daf-bdac-883e1df13e89"><img src="https://www.notion.so/signed/https%3A%2F%2Fs3-us-west-2.amazonaws.com%2Fsecure.notion-static.com%2F55b56e06-0063-4b08-a2e2-4b37f0842fd0%2FUntitled.png?width=696&amp;table=block&amp;id=1236db2e-39df-4daf-bdac-883e1df13e89" style="width:696px"/></a><figcaption><span class="SemanticStringArray"></span></figcaption></figure></div><div id="https://www.notion.so/eca60cafd45149538ed386440d6e55aa" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">오버라이드용 재질을 하나 만들고 Pass Index는 1로 지정. 원래 셰이더의 두 번째 패스로 알파 블렌딩 패스를 끼워 넣을 예정.</span></span></p></div><div id="https://www.notion.so/10c142616af14eddb17da24033f91d58" class="Image Image--Normal"><figure><a href="https://www.notion.so/signed/https%3A%2F%2Fs3-us-west-2.amazonaws.com%2Fsecure.notion-static.com%2F0d4ecefc-4b76-4e21-b5c7-248b4e5b49e0%2FUntitled.png?width=696&amp;table=block&amp;id=10c14261-6af1-4edd-b17d-a24033f91d58"><img src="https://www.notion.so/signed/https%3A%2F%2Fs3-us-west-2.amazonaws.com%2Fsecure.notion-static.com%2F0d4ecefc-4b76-4e21-b5c7-248b4e5b49e0%2FUntitled.png?width=696&amp;table=block&amp;id=10c14261-6af1-4edd-b17d-a24033f91d58" style="width:696px"/></a><figcaption><span class="SemanticStringArray"></span></figcaption></figure></div><div id="https://www.notion.so/d4b1c4f48d004dc3b7e36ace8368a67b" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">이렇게 재질을 오버라이드하는 방식은 셰이더 프로퍼티도 모두 덮어 써야 하기 때문에, 프로퍼티는 그대로 쓰면서 패스만 더해주고 싶을 때는 불편하다. 헤어 재질도 여러 개가 될 수 있으므로 그때마다 렌더러 설정을 바꿔주는 코딩도 해야 하고. 우선 돌아가는지만 보고 다른 해결책을 찾아야겠다.</span></span></p></div><div id="https://www.notion.so/2e55714947194d3787cdd0701581ce51" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">오.. 예상대로는 잘 돌아간다. 근데 알파 블렌딩되는 부분이 이상하다. 분명히 불투명 오브젝트를 다 그리고 난 후에 그리라고 설정했는데(After Rendering Opaques) 터레인이 그려지기 전에 알파 블렌딩 패스가 그려진다. RenderObjects 사용법 중에 모르는 것이 있나 보다.</span></span></p></div><div id="https://www.notion.so/d3b1edc453004d19a58d629613b8e549" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">RenderObjects의 Event를 이리저리 바꿔줘도 효과가 없다. 잘못 이해한 건가. 소스 체크 고고.</span></span></p></div><div id="https://www.notion.so/f6446597e6f342ed95933e604fa61f87" class="Image Image--Normal"><figure><a href="https://www.notion.so/signed/https%3A%2F%2Fs3-us-west-2.amazonaws.com%2Fsecure.notion-static.com%2Fa32ed15b-6b51-4c6a-bbd2-bdaa44405c2f%2FUntitled.png?width=481&amp;table=block&amp;id=f6446597-e6f3-42ed-9593-3e604fa61f87"><img src="https://www.notion.so/signed/https%3A%2F%2Fs3-us-west-2.amazonaws.com%2Fsecure.notion-static.com%2Fa32ed15b-6b51-4c6a-bbd2-bdaa44405c2f%2FUntitled.png?width=481&amp;table=block&amp;id=f6446597-e6f3-42ed-9593-3e604fa61f87" style="width:481px"/></a><figcaption><span class="SemanticStringArray"></span></figcaption></figure></div><div id="https://www.notion.so/28e7e2ef45214c718e25992758fda445" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">RenderObjects 클래스에서 RenderObjectsPass 클래스로 넘겨진다. 이 패스는 ScriptableRenderer.EnqueuePass()에 전달되고 실행될 때 SortStable() 함수 안에서 정렬이 된다.  ScriptableRenderPass 클래스에는 &lt;, &gt; 오퍼레이터가 오버로딩되어있고, renderPassEvent 기준으로 반환한다. 그렇다면, 위에 넣어준 Event에 맞게 정렬이 되야할 것 같은데 이상하다.</span></span></p></div><div id="https://www.notion.so/a7fda30ca1664ec2b6fda9bc044b43fc" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">SortStable()에 브레이크포인트를 걸어보니 잘 걸린다. 정렬이 잘 되나 보자.</span></span></p></div><div id="https://www.notion.so/afac5f90641a4ffc895e3f6213b6f15f" class="Image Image--Normal"><figure><a href="https://www.notion.so/signed/https%3A%2F%2Fs3-us-west-2.amazonaws.com%2Fsecure.notion-static.com%2Fa73fdbb6-dde5-45ff-b9da-ce299b916c35%2FUntitled.png?width=474&amp;table=block&amp;id=afac5f90-641a-4ffc-895e-3f6213b6f15f"><img src="https://www.notion.so/signed/https%3A%2F%2Fs3-us-west-2.amazonaws.com%2Fsecure.notion-static.com%2Fa73fdbb6-dde5-45ff-b9da-ce299b916c35%2FUntitled.png?width=474&amp;table=block&amp;id=afac5f90-641a-4ffc-895e-3f6213b6f15f" style="width:474px"/></a><figcaption><span class="SemanticStringArray"></span></figcaption></figure></div><div id="https://www.notion.so/323851dcc8fb4451ac1fe3b1f4e3eb57" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">정렬은 잘되어 있고, 그 순서대로 RenderObjectsPass.Execute() 는 호출된다. 그 안에서 ScriptableRenderContext에 DrawRenderers()나 ExecuteCommandbuffer()를 호출한다. 근데, 왜 순서가 안맞을까?</span></span></p></div><div id="https://www.notion.so/0bdd6cf7cc4341998151e917a6f5274c" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">컥, RenderObjects 설정을 없애도 알파 블렌딩 패스가 그려진다.</span></span></p></div><div id="https://www.notion.so/f8e682c27e464957ad4ff2a4d0a9567a" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">그렇다. RenderObjects는 동작하고 있지 않았고, 그냥 셰이더의 2패스가 연속으로 그려졌던 것. 알파블렌딩 패스에는 Tag도 없는데 왜 그려졌을까?</span></span></p></div><div id="https://www.notion.so/f410d815c59c41edac61ee49bc540bb1" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">스펙인지 버그인지 모르겠지만 셰이더에서 첫 번째 패스에 Tags {“LightMode” = “UniversalForward”}로 하고 두 번째 패스에 Tags를 지우니 두 개의 연속된 드로우콜로 그려진다. 두 번째 패스에 Tags를 다시 넣으면 첫 번째 패스만 그려진다. 혹시나 하고 두 패스 모두 Tags를 지우니 마찬가지로 첫 번째 패스만 그려진다.</span><span class="SemanticString">프레임 디버거에 이렇게 멀티 패스 셰이더라고 언급하는 걸 보면 단순한 버그는 아닌 것 같다.</span></span></p></div><div id="https://www.notion.so/3142825e0ca74664aae26035d888f415" class="Image Image--Normal"><figure><a href="https://www.notion.so/signed/https%3A%2F%2Fs3-us-west-2.amazonaws.com%2Fsecure.notion-static.com%2Fccb6bed3-09ca-4e24-b4aa-f8ac9e8afddc%2FUntitled.png?width=409&amp;table=block&amp;id=3142825e-0ca7-4664-aae2-6035d888f415"><img src="https://www.notion.so/signed/https%3A%2F%2Fs3-us-west-2.amazonaws.com%2Fsecure.notion-static.com%2Fccb6bed3-09ca-4e24-b4aa-f8ac9e8afddc%2FUntitled.png?width=409&amp;table=block&amp;id=3142825e-0ca7-4664-aae2-6035d888f415" style="width:409px"/></a><figcaption><span class="SemanticStringArray"></span></figcaption></figure></div><div id="https://www.notion.so/2ab55dcc26bf433a825c3587a2803deb" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">불투명한 오브젝트를 그리는 ScriptableRenderPass를 디버깅해보자. ShaderTagIdList에는 예상대로만 들어 있다. (ShaderTagIdList에 포함되는 태그와 일치하는 셰이더 패스를 가진 셰이더를 가진 재질을 가진 렌더러를 가진 오브젝트들만 그려지는 것이 원래 스펙입니다. )</span></span></p></div><div id="https://www.notion.so/67d67f035fff4e98bc223b4e90094a0b" class="Image Image--Normal"><figure><a href="https://www.notion.so/signed/https%3A%2F%2Fs3-us-west-2.amazonaws.com%2Fsecure.notion-static.com%2Fdad4e001-5110-409c-8913-783537f049f6%2FUntitled.png?width=381&amp;table=block&amp;id=67d67f03-5fff-4e98-bc22-3b4e90094a0b"><img src="https://www.notion.so/signed/https%3A%2F%2Fs3-us-west-2.amazonaws.com%2Fsecure.notion-static.com%2Fdad4e001-5110-409c-8913-783537f049f6%2FUntitled.png?width=381&amp;table=block&amp;id=67d67f03-5fff-4e98-bc22-3b4e90094a0b" style="width:381px"/></a><figcaption><span class="SemanticStringArray"></span></figcaption></figure></div><div id="https://www.notion.so/7fd4850a857b4e3da0e593e65037e880" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">공개된 소스코드 안에서는 왜 태그가 없는 패스도 같이 그려지는지는 알 수가 없다. 증상만 정리하면 이렇다.</span></span></p></div><ul class="BulletedListWrapper"><li id="https://www.notion.so/19c7d3d573c64fdc905e6e0967a87b1b" class="BulletedList"><span class="SemanticStringArray"><span class="SemanticString">두 패스 모두 UniversalForward 태그가 있으면 첫 번째 패스만 그려진다</span></span></li><li id="https://www.notion.so/e102b834659b41b59980f5527297c119" class="BulletedList"><span class="SemanticStringArray"><span class="SemanticString">두 패스 모두 태그가 없으면 첫번째 패스만 그려진다</span></span></li><li id="https://www.notion.so/329f7fe3e75d4329a9eeb5a276f10154" class="BulletedList"><span class="SemanticStringArray"><span class="SemanticString">두 패스 모두 UniversalForward가 아닌 이상한 이름의 태그를 지정하면 아무것도 안 그려진다</span></span></li><li id="https://www.notion.so/a2af5742a18a404b8cfed5f9ae8758b1" class="BulletedList"><span class="SemanticStringArray"><span class="SemanticString">한 패스가 UniversalForward 태그를 가지고 다른 패스가 태그가 없으면 둘 다 그려진다. 패스 순서에 상관없이 태그가 붙은 패스 먼저 그려짐.</span></span><ul class="BulletedListWrapper"><li id="https://www.notion.so/7c79560ed3d74a659be3f1dffa3d38fb" class="BulletedList"><span class="SemanticStringArray"><span class="SemanticString">이 때 태그 없는 패스가 하나 더 있어도 그려지지는 않는다</span></span></li></ul></li><li id="https://www.notion.so/c4d3ae9e624640b0a30e6b50791df4e6" class="BulletedList"><span class="SemanticStringArray"><span class="SemanticString">두 패스 모두 UniversalForward 태그가 있으면 첫 번째 패스만 그려진다</span></span></li></ul><div id="https://www.notion.so/bf933b3be7694c22a6c74386fdbe37cc" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">어쨌든 우리 셰이더는 불투명에서 한 번, 투명에서 한 번 그려줘야 하므로 이 기능(혹은 버그)를 사용할 수 없다.</span></span></p></div><div id="https://www.notion.so/d77e60fe9e0a4af7b5425433a96ce681" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">그러니, Render Objects 기능이 왜 동작을 안 하는지 파악해서 돌아가게 하자. 확인해 보니 문제의 원인은 Filters에 잘못된 값을 넣었기 때문. 일단 Queue는 Opaque를 넣어야 한다. 기본적으로 URP에 의해서 렌더링되는 첫번째 패스에 대한 정보를 넣어줘야 된다. 그러면 URP가 다시 해당 오브젝트를 렌더링하면서 이번에는 오버라이드된 재질로 그리는 방식이니까.</span></span></p></div><div id="https://www.notion.so/c82d26b4fa7c4818ae7dafefa500a69e" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">또 한 가지 잘못한 것은 Shader Passes에 패스의 Name을 넣었는데, Tags의 LightMode 값을 넣어야 한다. 아래의 코드를 예를 들면 “StandardLit”이 아니라 “UniversalForward”를 넣어야 한다.</span></span></p></div><pre id="https://www.notion.so/b854eea203c04b36aea27ee111ac2149" class="Code"><code><span class="SemanticStringArray"><span class="SemanticString"><span> Pass
        <span class="token punctuation">{</span>
            Name <span class="token string">"StandardLit"</span>
            Tags<span class="token punctuation">{</span><span class="token string">"LightMode"</span> <span class="token operator">=</span> <span class="token string">"UniversalForward"</span><span class="token punctuation">}</span></span></span></span></code></pre><div id="https://www.notion.so/6bc59552a41e45c7bba76c8187072c4c" class="Image Image--Normal"><figure><a href="https://www.notion.so/signed/https%3A%2F%2Fs3-us-west-2.amazonaws.com%2Fsecure.notion-static.com%2F842dcb42-b324-4302-96ff-fef4619288a8%2FUntitled.png?width=439&amp;table=block&amp;id=6bc59552-a41e-45c7-bba7-6c8187072c4c"><img src="https://www.notion.so/signed/https%3A%2F%2Fs3-us-west-2.amazonaws.com%2Fsecure.notion-static.com%2F842dcb42-b324-4302-96ff-fef4619288a8%2FUntitled.png?width=439&amp;table=block&amp;id=6bc59552-a41e-45c7-bba7-6c8187072c4c" style="width:439px"/></a><figcaption><span class="SemanticStringArray"></span></figcaption></figure></div><div id="https://www.notion.so/6ce4d003ab7d4d31ba8943f655752bcd" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">결론적으로 Render Features는 내 용도에 맞는 물건이 아니다. (용도에 맞는 물건이 맞아요. 제정신이 아니었나 봐요. 설명은 뒤에..) 우선 패스의 Name으로 필터가 안되기 때문에 헤어 게임오브젝트만 덧그릴 방법이 없다. 그리고 재질 애셋을 넣어주는 방식이라서 재질이 런타임에 변경되어서 Instanced로 되어 버리면 첫 번째 패스는 Instanced 된 재질을 쓰고, 두 번째 패스는 재질 애셋을 쓰게 되어서 셰이더 파라메터들이 달라지는 문제가 있다.</span></span></p></div><div id="https://www.notion.so/77a28d3093e84a8fb3132062a1fda49b" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">코딩을 좀 하더라도 가능한 방법을 찾아보자. 결국에는 FilteringSettings에 의해서 무엇을 그릴지 결정되는데 이 안에는 RenderingLayerMask가 있다.</span></span></p></div><div id="https://www.notion.so/f9576bed85cd4f3e8d3e3932f9a38f1e" class="Bookmark"><a href="https://docs.unity3d.com/ScriptReference/Rendering.FilteringSettings-renderingLayerMask.html"><h5 class="Bookmark__Title">Unity - Scripting API: Rendering.FilteringSettings.renderingLayerMask</h5><p class="Bookmark__Desc">Thank you for helping us improve the quality of Unity Documentation. Although we cannot accept all submissions, we do read each suggested change from our users and will make updates where applicable. For some reason your suggested change could not be submitted. Please try again in a few minutes.</p><p class="Bookmark__Link">https://docs.unity3d.com/ScriptReference/Rendering.FilteringSettings-renderingLayerMask.html</p></a></div><div id="https://www.notion.so/80c6874081de43a39826e14c94fade04" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">이는 그냥 Layer와 다른 것으로 MeshRenderer에 보면 지정할 수 있게 되어 있다.</span></span></p></div><div id="https://www.notion.so/8a45469d29e14460b673a7ab8a7e8c5b" class="Image Image--Normal"><figure><a href="https://www.notion.so/signed/https%3A%2F%2Fs3-us-west-2.amazonaws.com%2Fsecure.notion-static.com%2F7c541322-aca9-4920-911c-b0cf6da735cc%2FUntitled.png?width=435&amp;table=block&amp;id=8a45469d-29e1-4460-b673-a7ab8a7e8c5b"><img src="https://www.notion.so/signed/https%3A%2F%2Fs3-us-west-2.amazonaws.com%2Fsecure.notion-static.com%2F7c541322-aca9-4920-911c-b0cf6da735cc%2FUntitled.png?width=435&amp;table=block&amp;id=8a45469d-29e1-4460-b673-a7ab8a7e8c5b" style="width:435px"/></a><figcaption><span class="SemanticStringArray"></span></figcaption></figure></div><div id="https://www.notion.so/f08184b4b98541c18eecac4af085f90d" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">우선 필터링은 해결. RenderingLayerMask를 써서 헤어용 레이어를 하나 할당하면 될 것 같다. (결국에는 다른 방법을 씁니다. 설명은 뒤에..)</span></span></p></div><div id="https://www.notion.so/630c0a202afa44f2ae2e9ba23b036221" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">재질이 분리되는 이슈는 재질은 오버라이드 하지 않고 패스만 오버라이드 할 수 있으면 해결된다. DrawSettings에 재질 오버라이드 프로퍼티와 패스 오버라이드 프로퍼티가 분리되어 있기는 한데 재질을 오버라이드 하지 않아도 작동할지는 해봐야 안다.</span></span></p></div><div id="https://www.notion.so/8fe940df65e4446896aa78c08015e5b8" class="Bookmark"><a href="https://docs.unity3d.com/ScriptReference/Rendering.DrawingSettings-overrideMaterialPassIndex.html"><h5 class="Bookmark__Title">Unity - Scripting API: Rendering.DrawingSettings.overrideMaterialPassIndex</h5><p class="Bookmark__Desc">Thank you for helping us improve the quality of Unity Documentation. Although we cannot accept all submissions, we do read each suggested change from our users and will make updates where applicable. For some reason your suggested change could not be submitted. Please try again in a few minutes.</p><p class="Bookmark__Link">https://docs.unity3d.com/ScriptReference/Rendering.DrawingSettings-overrideMaterialPassIndex.html</p></a></div><div id="https://www.notion.so/5a381ee512014a32b10496beebac907f" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">이 두 가지가 된다면 OK. 우선 패스만 오버라이드 가능한지 테스트하기 위해서 URP 코드를 살짝 바꿔보자.</span></span></p></div><div id="https://www.notion.so/10e2abb3713b45c19e19244cd62e9e5e" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">RenderObjectPass.Execute()에서 아래 줄을 주석.</span></span></p></div><pre id="https://www.notion.so/b7a368cf0f214c51932c645fb13d84e6" class="Code Code--NoWrap"><code><span class="SemanticStringArray"><span class="SemanticString"><span><span class="token comment">//drawingSettings.overrideMaterial = overrideMaterial;</span></span></span></span></code></pre><div id="https://www.notion.so/f041fdde87384d669f79e8e81586e20b" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">안된다 ㅠ 재질을 오버라이드해야만 패스를 바꿀 수 있다. 아.. 캐릭터가 한 명만 나오면 인스턴스화 된 재질을 찾아서 직접 넣어줄 텐데 여러 캐릭터가 나올 거라. 재질을 오버라이드하지 않고 패스만 오버라이드할 방법이 필요하다.</span></span></p></div><div id="https://www.notion.so/83af206c8e3c477da207602287a9e609" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">아! 생각의 방향이 잘못되었다. (이제야 깨달음을 얻었습니다. 이제부터가 최종 버전입니다.) 그냥 필터 설정에서 패스 이름을 UniversalForward가 아닌, 두 번째 패스의  LightMode 값을 넣어주면, 해당 패스로 그리게 된다.</span></span></p></div><div id="https://www.notion.so/6d6a19f870564280b632e974e3aeec6f" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">셰이더에서 두 번째 패스에 태그를 이렇게 주고 Tags {“LightMode” = “HairAlphablending”} RenderObjects의 Shader Passes를 이렇게 주면 된다.</span></span></p></div><div id="https://www.notion.so/f2ece079ebd34c45914877730c153884" class="Image Image--Normal"><figure><a href="https://www.notion.so/signed/https%3A%2F%2Fs3-us-west-2.amazonaws.com%2Fsecure.notion-static.com%2F8e0936f6-75fd-4a23-8e5f-50abb58e1575%2FUntitled.png?width=454&amp;table=block&amp;id=f2ece079-ebd3-4c45-9148-77730c153884"><img src="https://www.notion.so/signed/https%3A%2F%2Fs3-us-west-2.amazonaws.com%2Fsecure.notion-static.com%2F8e0936f6-75fd-4a23-8e5f-50abb58e1575%2FUntitled.png?width=454&amp;table=block&amp;id=f2ece079-ebd3-4c45-9148-77730c153884" style="width:454px"/></a><figcaption><span class="SemanticStringArray"></span></figcaption></figure></div><div id="https://www.notion.so/2f6801e1baac4194ba6b311bc07811ab" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">이렇게 하면 HairAlphablending이라는 LightMode 태그를 가진 셰이더 패스만 그려지게 되므로, 별도로 RenderingLayerMask 같은 것으로 필터링 할 필요도 없다. 헤어 셰이더만 HairAlphablending 패스를 가질테니까.</span></span></p></div><div id="https://www.notion.so/8995300631ed42948caccd039e7198e3" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">이렇게 해서 같은 셰이더 프로퍼티를 사용해서 불투명 패스, 투명 패스를 그리는 셰이더 구현 성공!</span></span></p></div></article>
    
  <script src="https://utteranc.es/client.js"
        repo="muscly/utterances"
        issue-term="pathname"
        theme="github-light"
        crossorigin="anonymous"
        async>
  </script>
    
  <footer class="Footer">
  <div>&copy; Secret Wiki 2019-2021</div>
  <div>&centerdot;</div>
  <div>Powered by <a href="https://github.com/dragonman225/notablog" target="_blank"
      rel="noopener noreferrer">Notablog</a>.
  </div>
</footer>
</body>

</html>
